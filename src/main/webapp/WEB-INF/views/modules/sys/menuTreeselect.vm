#parse("/layouts/nolayout.vm")
#parse("/include/treeview.vm")
<div id="menuTreeselect" class="ztree" style="margin:15px;"></div>
<script type="text/javascript">
	var menuTreeselectSetting = {view:{selectedMulti:false,dblClickExpand:false,nameIsHTML:true,showIcon:false,showTitle:false}, data:{simpleData:{enable:true}},
			callback:{onClick:function(event, treeId, treeNode){menuTreeselect.expandNode(treeNode);if (!treeNode.isParent){cookie('menuId', treeNode.id, {path:'/'});}}}};
	var menuTreeselectNodes=[
	        #foreach($menu in $userUtils.getMenuList())
                #if(${menu.isShow} == '1')
                    {
                        id:"${menu.id}"
                        #if(!${menu.parent.id}) pId:"${menu.parent.id}", #else pId:"0", #end
                        name:"<i #if(!${menu.icon}) class='icon-${menu.icon}' #else class='icon-file' #end}\"></i>&nbsp;#if(!${menu.parent.id})${menu.name}#end",
                        url:"#if(!${ menu.href} && $stringUtils.indexOf(${menu.href}, '://') > -1)${ctx}#end#if(!${menu.href})${menu.href}#else javascript:#end",
                        #if(!${menu.target}) target:"${menu.target}"#else target:"_self"#end
                    },
                #end
            #end
            {id:new Date().getTime(), pId:"0", name:"<i class=\"icon-home\"></i>&nbsp;进入主页", url:"${ctx}", target:"_self"},
			{id:new Date().getTime(), pId:"0", name:"<i class=\"icon-share\"></i>&nbsp;退出登录", url:"${ctx}/logout", target:"_self"}];
	var menuTreeselect = $.fn.zTree.init($("#menuTreeselect"), menuTreeselectSetting, menuTreeselectNodes);
    #if(${parentId})
        var menuTreeselectNodes = menuTreeselect.getNodesByParam("level", 1);
        for(var i=0; i<menuTreeselectNodes.length; i++) {
            menuTreeselect.expandNode(menuTreeselectNodes[i], true, false, false);
        }
    #end
	var menuTreeselectNode = menuTreeselect.getNodeByParam("id", '#if(!${parentId} && ${parentId} != '')$!{parentId}#else$!{cookie.menuId.value}#end');
	menuTreeselect.selectNode(menuTreeselectNode, true);
	menuTreeselect.expandNode(menuTreeselectNode, true, false, false);
</script>